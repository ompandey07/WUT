<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WUT</title>
    <link rel="shortcut icon" href="/static/Icons/Favicon.png" type="image/x-icon">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Dancing+Script&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" rel="stylesheet">
    <style>
        body { 
            font-family: 'Roboto', sans-serif;
        }
        .font-script { 
            font-family: 'Dancing Script', cursive; 
        }
        .scrollable-content {
            max-height: calc(100vh - 180px);
            overflow-y: auto;
        }
        .sidebar-item {
            transition: transform 0.3s ease;
        }
        .sidebar-item:hover {
            transform: scale(1.05);
        }
        .modal {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal.hide {
            animation: fadeOut 0.3s ease-in-out;
        }
        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }
        @keyframes high-five {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-15deg); }
            50% { transform: rotate(15deg); }
            75% { transform: rotate(-15deg); }
        }
        .animate-high-five {
            animation: high-five 2s ease-in-out infinite;
        }
        .dark {
            background-color: #1a202c;
            color: #e2e8f0;
        }
        .dark .bg-gray-100 {
            background-color: #2d3748;
        }
        .dark .border-gray-300 {
            border-color: #4a5568;
        }
        .dark .text-gray-700 {
            color: #e2e8f0;
        }
        .dark .hover\:bg-gray-100:hover {
            background-color: #4a5568;
        }
        .dark .bg-white {
            background-color: #2d3748;
        }
        .dark .text-gray-500 {
            color: #a0aec0;
        }
        .dark .modal-content {
            background-color: #2d3748;
            color: #e2e8f0;
        }
        .dark .modal-content h2 {
            color: #90cdf4;
        }
        .dark .modal-content textarea {
            background-color: #4a5568;
            color: #e2e8f0;
            border-color: #718096;
        }
        .dark .modal-content button {
            background-color: #4299e1;
            color: #e2e8f0;
        }
        .dark .modal-content button:hover {
            background-color: #3182ce;
        }
        .mobile-menu {
            position: fixed;
            top: 0;
            height: 100%;
            width: 100%;
            background-color: white;
            z-index: 1000;
            transition: left 0.3s ease-in-out, right 0.3s ease-in-out;
        }
        .left-menu {
            left: -100%;
        }
        .right-menu {
            right: -100%;
        }
        .mobile-menu.open {
            left: 0;
            right: 0;
        }
        .task-item {
            border-bottom: 1px solid #e5e7eb;
        }
        .task-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="h-screen flex flex-col" id="app">
        <!-- Header -->
        <div class="flex justify-between items-center px-4 py-2 border-b border-gray-300 bg-white">
            <div class="flex items-center">
                <button id="leftMenuToggle" class="lg:hidden mr-4">
                    <i class="ri-menu-line text-2xl"></i>
                </button>
                <div class="w-20 h-6">
                    <img src="/static/Images/Logo.png" alt="Logo" class="w-full h-full object-contain"/>
                </div>
            </div>
            <div class="flex items-center">
                <button id="rightMenuToggle" class="lg:hidden mr-4">
                    <i class="ri-menu-2-line text-2xl"></i>
                </button>
                <button id="darkModeToggle" class="mr-4">
                    <i id="darkModeIcon" class="ri-sun-line text-2xl"></i>
                </button>
                <div class="relative" id="userMenu">
                    <div class="flex items-center cursor-pointer" onclick="toggleMenu()">
                        <div class="w-6 h-6 bg-gray-300 rounded-full mr-2 overflow-hidden border border-gray-400">
                            {% if profile_picture %}
                                <img src="{{ profile_picture }}" alt="{{ user.get_full_name }}" class="w-full h-full object-cover"/>
                            {% else %}
                                <img src="https://www.w3schools.com/howto/img_avatar.png" alt="Default Avatar" class="w-full h-full object-cover"/>
                            {% endif %}
                        </div>
                        <span class="hidden sm:inline">{{ user.get_full_name }}</span>
                    </div>
                    <div id="userSubmenu" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg hidden z-10">
                        <a href="{% url 'user_profile' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                            <i class="ri-user-line mr-2"></i>Profile
                        </a>
                        <a href="/logout" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                            <i class="ri-logout-box-line mr-2"></i>Logout
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex flex-1 overflow-hidden">
            <!-- Left Sidebar (hidden on mobile) -->
            <div class="hidden lg:block w-48 border-r border-gray-300 p-4 bg-white">                
                <a href="{% url 'work' %}" class="sidebar-item flex items-center mb-6 text-green-500 hover:text-green-700">
                    <img src="/static/Icons/gems.png" alt="Works" class="w-6 h-6 mr-2 object-cover rounded-full"/>
                    <span>Gems</span>
                </a>
                <a href="#" class="sidebar-item flex items-center text-purple-500 hover:text-purple-700">
                    <img src="/static/Icons/Shield.png" alt="Backup Tool" class="w-6 h-6 mr-2 object-cover rounded-full"/>
                    <span>Shield</span>
                </a>
            </div>
            
            <!-- Main Content -->
            <div class="flex-1 flex flex-col">
                <a href="#" class="text-3xl font-script text-center py-4 border-b border-gray-300" onclick="showShareThoughtsModal()">Share Thoughts</a>
                <div class="mt-4 scrollable-content px-4" id="postsContainer">
                    <!-- Posts will be loaded here -->
                </div>
            </div>
            
            <!-- Right Sidebar (hidden on mobile) -->
            <div class="hidden lg:block w-64 border-l border-gray-300 p-4 flex flex-col h-full bg-white">
                <h3 class="font-script text-3xl mb-6 mt-4">Recent Tasks</h3>
                <div class="flex-grow overflow-y-auto mb-4">
                    {% if recent_tasks %}
                        <ul class="space-y-1">
                            {% for task in recent_tasks %}
                                <li class="task-item p-2 text-sm transition-all duration-200 ease-in-out hover:bg-gray-100">
                                    <p class="font-semibold truncate">{{ task.content }}</p>
                                    <p class="text-xs text-gray-500">{{ task.created_at|date:"M d, Y H:i" }}</p>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="text-gray-500 text-center">No recent tasks</p>
                    {% endif %}
                </div>
                <a href="{% url 'work' %}" class="text-blue-500 text-center w-full hover:underline transition-all duration-300 py-2">View All Tasks</a>
            </div>
        </div>

        <!-- Sticky Footer -->
        <div class="sticky bottom-0 h-15 flex items-center justify-between px-4 border-t border-gray-300 bg-white">
            <div class="w-6 h-6">
                <img src="/static/Images/Logo.png" alt="Logo" class="w-full h-full object-contain"/>
            </div>
            <div class="text-sm">Â© Mega Minds pvt ltd</div>
            <div class="text-sm flex space-x-2" id="dateTime">
                <span id="currentDate"></span>
                <span id="currentTime"></span>
            </div>
        </div>
    </div>

    <!-- Left Mobile Menu -->
    <div id="leftMobileMenu" class="mobile-menu left-menu lg:hidden">
        <div class="flex justify-between items-center p-4 border-b border-gray-300">
            <h2 class="text-xl font-bold">Menu</h2>
            <button id="closeLeftMenu">
                <i class="ri-close-line text-2xl"></i>
            </button>
        </div>
        <div class="p-4">
            <a href="{% url 'work' %}" class="sidebar-item flex items-center mb-6 text-green-500 hover:text-green-700">
                <img src="/static/Icons/gems.png" alt="Works" class="w-6 h-6 mr-2 object-cover rounded-full"/>
                <span>Gems</span>
            </a>
            <a href="#" class="sidebar-item flex items-center text-purple-500 hover:text-purple-700">
                <img src="/static/Icons/Shield.png" alt="Backup Tool" class="w-6 h-6 mr-2 object-cover rounded-full"/>
                <span>Shield</span>
            </a>
        </div>
    </div>

    <!-- Right Mobile Menu -->
    <div id="rightMobileMenu" class="mobile-menu right-menu lg:hidden">
        <div class="flex justify-between items-center p-4 border-b border-gray-300">
            <h2 class="text-xl font-bold">Recent Tasks</h2>
            <button id="closeRightMenu">
                <i class="ri-close-line text-2xl"></i>
            </button>
        </div>
        <div class="p-4">
            {% if recent_tasks %}
                <ul class="space-y-1">
                    {% for task in recent_tasks %}
                        <li class="task-item p-2 text-sm transition-all duration-200 ease-in-out hover:bg-gray-100">
                            <p class="font-semibold truncate">{{ task.content }}</p>
                            <p class="text-xs text-gray-500">{{ task.created_at|date:"M d, Y H:i" }}</p>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="text-gray-500 text-center">No recent tasks</p>
            {% endif %}
            <a href="{% url 'work' %}" class="text-blue-500 text-center w-full hover:underline transition-all duration-300 py-2 block mt-4">View All Tasks</a>
        </div>
    </div>

        <!-- Welcome Modal -->
       <div id="welcomeModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 modal hidden">
           <div class="bg-white p-4 sm:p-8 max-w-sm sm:max-w-md w-11/12 text-center shadow-2xl modal-content ">
               <h2 class="text-2xl sm:text-3xl font-bold mb-2 sm:mb-4 text-blue-600">Welcome, {{ user.first_name }}! ðŸ‘‹</h2>
               <p class="text-base sm:text-lg mb-4 sm:mb-6">We're thrilled to have you here!</p>
               <div class="mb-4 sm:mb-6">
                   <h3 class="text-lg sm:text-xl font-semibold mb-2">Here's a joke to brighten your day:</h3>
                   <p id="jokeSetup" class="text-gray-700 italic mb-2"></p>
                   <p id="jokePunchline" class="text-gray-700 italic font-bold"></p>
               </div>
               <button onclick="hideWelcomeModal()" class="px-4 sm:px-6 py-2 bg-blue-500 text-white rounded-full hover:bg-blue-600 transition-colors duration-300 text-sm sm:text-base">
                   Let's Get Started!
               </button>
           </div>
       </div>

        <!-- Share Thoughts Modal -->
      <div id="shareThoughtsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 modal hidden">
          <div class="bg-white p-4 sm:p-8 max-w-sm sm:max-w-lg w-11/12 shadow-2xl transform transition-all duration-300 ease-in-out modal-content ">
              <div class="flex justify-between items-center mb-4 sm:mb-6">
                  <h2 class="text-xl sm:text-3xl font-bold text-blue-600">Share your thoughts</h2>
                  <button onclick="hideShareThoughtsModal()" class="text-gray-500 hover:text-gray-700 transition-colors duration-300">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                      </svg>
                  </button>
              </div>
              <form id="postForm">
                  {% csrf_token %}
                  <textarea id="postContent" class="w-full h-32 sm:h-40 border border-gray-300 p-2 sm:p-4 mb-4 resize-none rounded-lg text-sm sm:text-base" placeholder="What's on your mind?"></textarea>
                  <div class="flex items-center justify-between">
                      <div class="flex space-x-2">
                          <button type="button" class="p-2 text-gray-500 hover:text-blue-500 transition-colors duration-300">
                              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6 animate-high-five" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11.5V14m0-2.5v-6a1.5 1.5 0 113 0m-3 6a1.5 1.5 0 00-3 0v2a7.5 7.5 0 0015 0v-5a1.5 1.5 0 00-3 0m-6-3V11m0-5.5v-1a1.5 1.5 0 013 0v1m0 0V11m0-5.5a1.5 1.5 0 013 0v3m0 0V11" />
                              </svg>
                          </button>
                      </div>
                      <button type="submit" class="px-4 sm:px-6 py-2 bg-blue-500 text-white rounded-full hover:bg-blue-600 transition-colors duration-300 flex items-center text-sm sm:text-base">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 mr-1 sm:mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                          </svg>
                          Share
                      </button>
                  </div>
               </form>
          </div>
      </div>

    <script>
        function toggleMenu() {
            const menu = document.getElementById('userSubmenu');
            menu.classList.toggle('hidden');
        }

        function updateDateTime() {
            const now = new Date();
            const date = now.toLocaleDateString();
            const time = now.toLocaleTimeString();
            document.getElementById('currentDate').textContent = date;
            document.getElementById('currentTime').textContent = time;
        }

        async function fetchJoke() {
            try {
                const response = await fetch('https://official-joke-api.appspot.com/random_joke');
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error fetching joke:', error);
                return {
                    setup: "Why did the scarecrow win an award?",
                    punchline: "Because he was outstanding in his field!"
                };
            }
        }

        async function showWelcomeModal() {
            const modal = document.getElementById('welcomeModal');
            const jokeSetup = document.getElementById('jokeSetup');
            const jokePunchline = document.getElementById('jokePunchline');
            
            modal.classList.remove('hidden');
            
            const joke = await fetchJoke();
            jokeSetup.textContent = joke.setup;
            jokePunchline.textContent = joke.punchline;

            setTimeout(() => {
                hideWelcomeModal();
            }, 10000);
        }

        function hideWelcomeModal() {
            const modal = document.getElementById('welcomeModal');
            modal.classList.add('hide');
            setTimeout(() => {
                modal.classList.add('hidden');
                modal.classList.remove('hide');
            }, 300);
        }

        function showShareThoughtsModal() {
            const modal = document.getElementById('shareThoughtsModal');
            modal.classList.remove('hidden');
        }

        function hideShareThoughtsModal() {
            const modal = document.getElementById('shareThoughtsModal');
            modal.classList.add('hide');
            setTimeout(() => {
                modal.classList.add('hidden');
                modal.classList.remove('hide');
            }, 300);
        }

        function toggleDarkMode() {
            const app = document.getElementById('app');
            const darkModeIcon = document.getElementById('darkModeIcon');
            app.classList.toggle('dark');
            
            if (app.classList.contains('dark')) {
                darkModeIcon.classList.remove('ri-sun-line');
                darkModeIcon.classList.add('ri-moon-line');
                localStorage.setItem('darkMode', 'enabled');
            } else {
                darkModeIcon.classList.remove('ri-moon-line');
                darkModeIcon.classList.add('ri-sun-line');
                localStorage.setItem('darkMode', 'disabled');
            }
        }

        function loadDarkModePreference() {
            const darkModePreference = localStorage.getItem('darkMode');
            const app = document.getElementById('app');
            const darkModeIcon = document.getElementById('darkModeIcon');

            if (darkModePreference === 'enabled') {
                app.classList.add('dark');
                darkModeIcon.classList.remove('ri-sun-line');
                darkModeIcon.classList.add('ri-moon-line');
            } else {
                app.classList.remove('dark');
                darkModeIcon.classList.remove('ri-moon-line');
                darkModeIcon.classList.add('ri-sun-line');
            }
        }

        function createPostElement(post) {
            const date = new Date(post.created_at);
            return `
                <div class="bg-white shadow-md p-4 mb-4 rounded">
                    <div class="flex justify-between items-center mb-2">
                        <div class="flex items-center">
                            <div class="w-8 h-8 bg-gray-300 rounded-full mr-2 overflow-hidden">
                                <img src="${post.profile_picture || 'https://www.w3schools.com/howto/img_avatar.png'}" alt="${post.user_name}" class="w-full h-full object-cover"/>
                            </div>
                            <span>${post.user_name}</span>
                        </div>
                        <span class="text-sm text-gray-500">${date.toLocaleTimeString()}</span>
                    </div>
                    <p class="mb-2">${post.content}</p>
                    <div class="flex justify-between items-center">
                        <span class="inline-flex items-center text-sm"><i class="ri-eye-line mr-1"></i>${post.views}</span>
                        <span class="text-sm">${date.toLocaleDateString()}</span>
                    </div>
                </div>
            `;
        }

        function loadPosts() {
            const postsContainer = document.getElementById('postsContainer');
            const postsData = JSON.parse(document.getElementById('postsData').textContent);
            postsContainer.innerHTML = postsData.map(createPostElement).join('');
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadPosts();

            document.getElementById('postForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const content = document.getElementById('postContent').value;
                const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

                fetch('', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'X-CSRFToken': csrftoken
                    },
                    body: `content=${encodeURIComponent(content)}`
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        const postsContainer = document.getElementById('postsContainer');
                        postsContainer.insertAdjacentHTML('afterbegin', createPostElement(data.post));
                        document.getElementById('postContent').value = '';
                        hideShareThoughtsModal();
                    } else {
                        alert(data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while posting. Please try again.');
                });
            });

            document.getElementById('darkModeToggle').addEventListener('click', toggleDarkMode);
            document.getElementById('leftMenuToggle').addEventListener('click', function() {
                document.getElementById('leftMobileMenu').classList.add('open');
            });
            document.getElementById('rightMenuToggle').addEventListener('click', function() {
                document.getElementById('rightMobileMenu').classList.add('open');
            });
            document.getElementById('closeLeftMenu').addEventListener('click', function() {
                document.getElementById('leftMobileMenu').classList.remove('open');
            });
            document.getElementById('closeRightMenu').addEventListener('click', function() {
                document.getElementById('rightMobileMenu').classList.remove('open');
            });

            updateDateTime();
            setInterval(updateDateTime, 1000);
            loadDarkModePreference();
            showWelcomeModal();
        });
    </script>
    <script id="postsData" type="application/json">
        {{ posts_json|safe }}
    </script>
</body>
</html>